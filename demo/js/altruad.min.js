var modalWindow=function(){var d;var c='<fieldset>        <label><span>From:</span><input id="from" type="email"></input></label>        <label><span>To:</span><input id="to" type="email"></input></label>        <textarea id="email-body" placeholder="Please enter your message here"></textarea>        <input id="email-submit" type="submit" value="Share"></input>    </fieldset>    <div id="close"></div>';function b(f){d=document.createElement("form");d.className="altruad-modal";d.innerHTML=c;f.parentNode.insertBefore(d,f.nextSibling);var e=document.getElementById("close");e.onclick=function(){modalWindow.hide()}}function a(f,g){var e=f.offsetTop+f.offsetHeight+40;if(window.innerHeight-findPos(f).top-f.offsetHeight+window.scrollY<=g.offsetHeight){e=-(f.offsetHeight+g.offsetHeight-35)}g.style.top=e+"px"}return{show:function(h){if(h){h.preventDefault()}var g=document.getElementsByClassName("altruad-modal");var f=document.getElementsByClassName("sharebuttons")[0];if(g.length){g[0].style.display="block"}else{b(f)}a(f,g[0])},hide:function(){d.style.display="none";fadeButtons(1)},success:function(){var f="<span>Email sent. Thanks for sharing!</span>";d.innerHTML=f;d.className+=" email-sent";this.show();var e=this;var g=window.setTimeout(function(){e.hide();d.innerHTML=c;d.className="altruad-modal"},5000)}}}();function fadeButtons(d,b){for(var a=0,c=buttons.length;a<c;a++){if(b&&hasClass(buttons[a],b)){continue}buttons[a].style.opacity=d}}function currentTime(){var a=Date.now()||function(){return +new Date};return Math.round(a/1000)}function transformParams(b){var c=[];for(var a in b){if(a!==null&&b.hasOwnProperty(a)){c.push(encodeURIComponent(a)+"="+encodeURIComponent(b[a]))}}return c.join("&")}function getParams(){var a={};(function(){var g,b=/\+/g,c=/([^&=]+)=?([^&]*)/g,h=function(d){return decodeURIComponent(d.replace(b," "))},f=window.location.search.substring(1);while(g=c.exec(f)){a[h(g[1])]=h(g[2])}})();return a}function randomId(d,e){d=d||6;var e=e||"abcdefghijklmnopqrtsuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a=e.length,c="";for(var b=0;b<d;b++){c+=e.charAt(Math.floor(Math.random()*a))}return c}function hasClass(b,a){return(" "+b.className+" ").indexOf(" "+a+" ")>-1}function findPos(a){var b=curTop=0;if(a.offsetParent){do{b+=a.offsetLeft;curTop+=a.offsetTop}while(a=a.offsetParent)}return{top:curTop,left:b}}var JSON=JSON||{};JSON.stringify=JSON.stringify||function(e){var d=typeof(e);if(d!="object"||e===null){if(d=="string"){e='"'+e+'"'}return String(e)}else{var f,b,c=[],a=(e&&e.constructor==Array);for(f in e){b=e[f];d=typeof(b);if(d=="string"){b='"'+b+'"'}else{if(d=="object"&&b!==null){b=JSON.stringify(b)}}c.push((a?"":'"'+f+'":')+String(b))}return(a?"[":"{")+String(c)+(a?"]":"}")}};Object.prototype.clone=function(){var a=(this instanceof Array)?[]:{};for(i in this){if(i=="clone"){continue}if(this[i]&&typeof this[i]=="object"){a[i]=this[i].clone()}else{a[i]=this[i]}}return a};var tooltip=function(){var d="share-info";var r=3;var f=3;var q=300;var g=10;var e=20;var l=95;var j=0;var m,s,o,p,k;var a=document.all?true:false;return{show:function(c,b){if(m==null){m=document.createElement("div");m.setAttribute("id",d);s=document.createElement("div");s.setAttribute("id",d+"top");o=document.createElement("div");o.setAttribute("id",d+"cont");p=document.createElement("div");p.setAttribute("id",d+"bot");m.appendChild(s);m.appendChild(o);m.appendChild(p);document.body.appendChild(m);m.style.opacity=0;m.style.filter="alpha(opacity=0)";document.onmousemove=this.pos}m.style.display="block";o.innerHTML=c;m.style.width=b?b+"px":"auto";if(!b&&a){s.style.display="none";p.style.display="none";m.style.width=m.offsetWidth;s.style.display="block";p.style.display="block"}if(m.offsetWidth>q){m.style.width=q+"px"}k=parseInt(m.offsetHeight)+r;clearInterval(m.timer);m.timer=setInterval(function(){tooltip.fade(1)},e)},pos:function(h){var c=a?event.clientY+document.documentElement.scrollTop:h.pageY;var b=a?event.clientX+document.documentElement.scrollLeft:h.pageX;m.style.top=(c-k)+"px";m.style.left=(b+f)+"px"},fade:function(h){var b=j;if((b!=l&&h==1)||(b!=0&&h==-1)){var c=g;if(l-b<g&&h==1){c=l-b}else{if(j<g&&h==-1){c=b}}j=b+(c*h);m.style.opacity=j*0.01;m.style.filter="alpha(opacity="+j+")"}else{clearInterval(m.timer);if(h==-1){m.style.display="none"}}},hide:function(){clearInterval(m.timer);m.timer=setInterval(function(){tooltip.fade(-1)},e)}}}();function Visit(){this.shareId=getParams().shareId||"";this.referrer=document.referrer;this.userCookie=this.getCookie("altruad-uid")||this.setCookie("altruad-uid",randomId(12));this.visitCookie=this.setCookie("altruad-vid",randomId(12),(60*60*1000));this.clicks=[];this.timer}Visit.prototype.sendData=function(e,f){var b="http://analytics.altruad.com/",a="rt.gif?",d=new Image();var c=e.clone();c.publisherId=options.publisher;c.shareId=this.shareId;c.userCookie=this.userCookie;c.visitCookie=this.visitCookie;d.src=b+a+transformParams(c);if(f){d.onload=f}};Visit.prototype.begin=function(){this.sendData({referrer:this.referrer,type:1});self=this;this.timer=window.setInterval(function(){self.ping(self)},30000)};Visit.prototype.ping=function(a){console.log("ping!");a.sendData({clicks:JSON.stringify(a.clicks),type:3})};Visit.prototype.end=function(){console.log("visit ending");this.sendData({clicks:JSON.stringify(this.clicks),type:2});this.deleteCookie("altruad-vid");clearTimeout(this.timer)};Visit.prototype.setCookie=function(c,d,b){b=b||365*24*60*60*1000;var a=new Date(currentTime()*1000+b);document.cookie=c+"="+d+"; expires="+a.toUTCString()+"; path=/";return d};Visit.prototype.getCookie=function(b){var c=new RegExp("^(?:"+b+"=)([\\w]+)"),a=document.cookie.match(c);if(a){return a[1]}};Visit.prototype.deleteCookie=function(a){this.setCookie(a,"",-60*60*1000)};Visit.prototype.recordClick=function(a){this.clicks.push(a);console.log(this.clicks)};function Share(a,b){visit.shareId=a.shareId;visit.sendData(a,b)}var buttons=document.getElementsByClassName("altruad");for(var i=0,n=buttons.length;i<n;i++){buttons[i].onclick=newShare}var links=document.getElementsByTagName("a");for(var i=0,n=links.length;i<n;i++){if(hasClass(links[i],"altruad")){continue}links[i].onclick=anchorClick}function newShare(o){var b=["twitter","facebook","email","google"],d=this.className.split(" ");for(var k=0,f=b.length;k!=f;k++){if(d.indexOf(b[k])!==-1){var r=b[k];break}}var c=randomId(),g=document.title,h=document.URL.split("?")[0]+"?shareId="+c,a;var m={url:document.URL,shareId:c,pageTitle:g,shareType:r,type:0};var q={twitter:"https://twitter.com/intent/tweet?",facebook:"http://facebook.com/sharer/sharer.php?",google:"https://plus.google.com/share?"};switch(r){case"facebook":a=transformParams({u:h});this.href=q.facebook+a;j(m);break;case"twitter":a=transformParams({url:h,text:g,});this.href=q.twitter+a;j(m);break;case"google":a=transformParams({url:h});this.href=q.google+a;j(m);break;case"email":var l="<input></input>";modalWindow.show(o);fadeButtons(0.5,"email");var p=document.getElementById("email-submit");p.onclick=function(s){console.log("new email share");s.preventDefault();m.to=document.getElementById("to").value;m.from=document.getElementById("from").value;m.message=document.getElementById("email-body").value;j(m);modalWindow.success()};break}function j(e){new Share(e)}}var visit=new Visit();visit.begin();function anchorClick(b){b=b||window.event;var a;if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType==3){a=a.parentNode}visit.recordClick({targetId:a.id,href:a.href,linkText:a.innerText})}window.onbeforeunload=function(){visit.end()};